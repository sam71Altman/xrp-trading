LPEM + PEG Integration â€“ Clean Aggressive Final
âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù„Ø²Ø§Ù…ÙŠ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„ÙŠØ³:
âŒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ¯Ø§ÙˆÙ„
âŒ ØªØºÙŠÙŠØ± Ø´Ø±ÙˆØ· Ø§Ù„Ø¯Ø®ÙˆÙ„
âŒ ØªØºÙŠÙŠØ± EMA / SL / TP
âŒ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
âŒ Ø¥Ø¶Ø§ÙØ© cooldown Ø²Ù…Ù†ÙŠ
âŒ ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© Ø§Ù„Ø¨ÙˆØª
Ù‡Ø°Ø§ Ø¯Ù…Ø¬ Ø³Ù„ÙˆÙƒÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙ‚Ø·.
ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙˆØ­ÙŠØ¯
Ù…Ù†Ø¹ Ø³Ù„ÙˆÙƒÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ† Ù„ÙƒÙ† Ù…ØªÙƒØ§Ù…Ù„ÙŠÙ†:
âŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¹Ø±ÙŠØ© Ø¨Ø¹Ø¯ Ø®Ø±ÙˆØ¬ ØµØºÙŠØ±
âŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø³ÙˆÙ‚ Ù„Ù… ÙŠØªØ¹Ø§ÙÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
Ù…Ø¹:
âœ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØ±ØµØ© ØµØ­ÙŠØ­Ø©
âœ… Ø§Ù„Ø­ÙØ§Ø¸ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© ÙˆØ§Ù„Ø³Ø±Ø¹Ø©
ğŸ§  Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© (Ø«Ø§Ø¨ØªØ©)
Ù‚Ø±Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø«Ù†Ø§Ø¦ÙŠ ÙÙ‚Ø·:
Enter âœ…
Block âŒ
ğŸš« Ù„Ø§ Partial
ğŸš« Ù„Ø§ Penalty
ğŸš« Ù„Ø§ Multiplier
ğŸš« Ù„Ø§ ØªØ¹Ù‚ÙŠØ¯ Ø¹Ø¯Ø¯ÙŠ
ğŸ§© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (ÙØµÙ„ ØªØ§Ù… â€“ Ù„Ø§ ØªØ¹Ø§Ø±Ø¶)
1ï¸âƒ£ LPEM â€“ Light Post-Exit Memory
Ø§Ù„Ø¯ÙˆØ±:
Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¹Ø±ÙŠØ© Ø¨Ø¹Ø¯ Ø®Ø±ÙˆØ¬ Ø¨Ø±Ø¨Ø­ ØµØºÙŠØ±.
ÙÙ„ØªØ± Ø³Ø¹Ø±ÙŠ (Micro)
Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ù‹Ø§
Ù„Ø§ ÙŠØ¹Ø±Ù Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚
Ù„Ø§ ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ø§Ù…
LPEM Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ â€“ Ù„Ø§ ØªØ¹Ø§Ø¯ ÙƒØªØ§Ø¨ØªÙ‡
2ï¸âƒ£ PEG â€“ Post-Exit Market Quality Gate
Ø§Ù„Ø¯ÙˆØ±:
Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¥Ø°Ø§ Ø§Ù„Ø³ÙˆÙ‚ Ù„Ù… ÙŠØªØ¹Ø§ÙÙ.
ÙÙ„ØªØ± Ø³ÙŠØ§Ù‚ÙŠ (Macro)
ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰:
Breakout
Higher Low
EMA20 > EMA50
Strong Immediate Recovery
Ù„Ù‡ Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ù†Ø¹ (Ø­Ù…Ø§ÙŠØ© ÙÙ‚Ø·)
3ï¸âƒ£ EntryGateMonitor (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
Ø§Ù„Ø¯ÙˆØ±:
Ù…Ø±Ø§Ù‚Ø¨Ø© Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ£Ø«ÙŠØ±.
ğŸ—ï¸ ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ­Øµ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
1. LPEM check  (Ø³Ø¹Ø±ÙŠ â€“ Ø³Ø±ÙŠØ¹)
2. PEG check   (Ø³ÙŠØ§Ù‚ÙŠ â€“ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø³Ù…Ø­ LPEM)
3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±
4. ÙØªØ­ Ø§Ù„ØµÙÙ‚Ø© Ø£Ùˆ Ù…Ù†Ø¹Ù‡Ø§
âš ï¸ Ù…Ù…Ù†ÙˆØ¹ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„ØªØ±ØªÙŠØ¨
ğŸ“ PEG â€“ PostExitGuard
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
# post_exit_guard.py

class PostExitGuard:
    _instance = None
    MAX_BLOCK_DURATION = 3600  # 1 Ø³Ø§Ø¹Ø© (Ø­Ù…Ø§ÙŠØ© ÙÙ‚Ø·)

    @classmethod
    def get(cls):
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance

    def __init__(self):
        self.active = False
        self.exit_price = None
        self.exit_time = None

    def record_exit(self, exit_price, timestamp):
        self.active = True
        self.exit_price = exit_price
        self.exit_time = timestamp
        log(f"[PEG] Exit recorded @ {exit_price}")

    def clear(self, reason):
        if self.active:
            log(f"[PEG] Cleared | reason={reason}")
        self.active = False
        self.exit_price = None
        self.exit_time = None

    def expired(self):
        if not self.active or not self.exit_time:
            return False
        return (now() - self.exit_time) > self.MAX_BLOCK_DURATION
ğŸ“ Market Recovery Logic
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
# market_recovery.py

def market_recovered(guard):
    # 1ï¸âƒ£ Breakout after exit
    last_high = get_pullback_high_since_exit(guard)
    if last_high and current_price > last_high:
        return True, "breakout"

    # 2ï¸âƒ£ Higher Low confirmed
    if higher_low_confirmed(guard):
        return True, "higher_low"

    # 3ï¸âƒ£ EMA recovery
    if ema20 > ema50:
        return True, "ema_recovery"

    # 4ï¸âƒ£ Strong immediate recovery
    lowest = get_lowest_price_since_exit(guard)
    if lowest:
        recovery_pct = (current_price - lowest) / lowest * 100
        if recovery_pct >= 1.5:
            return True, "strong_recovery"

    return False, None
ğŸ“ try_open_trade (Ù†Ù‚Ø·Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ÙˆØ­ÙŠØ¯Ø©)
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
def try_open_trade(signal):
    if not signal or not signal.valid:
        return None

    lpem = PostExitMemory.get_instance()
    peg = PostExitGuard.get()
    monitor = EntryGateMonitor.get()

    # 1ï¸âƒ£ LPEM check
    lpem_blocked = lpem.is_active() and lpem.blocks_entry(
        direction=signal.type,
        current_price=signal.price
    )

    if lpem_blocked:
        monitor.record_decision(lpem_blocked=True, peg_blocked=False, entered=False)
        log("[ENTRY GATE] BLOCKED by LPEM")
        return None

    # 2ï¸âƒ£ PEG check
    if peg.active:
        if peg.expired():
            peg.clear("max_duration_reached")
        else:
            recovered, reason = market_recovered(peg)
            if not recovered:
                monitor.record_decision(lpem_blocked=False, peg_blocked=True, entered=False)
                log("[ENTRY GATE] BLOCKED by PEG")
                return None
            peg.clear(f"recovered_{reason}")

    # 3ï¸âƒ£ Ø¯Ø®ÙˆÙ„ Ù†Ø¸ÙŠÙ
    monitor.record_decision(lpem_blocked=False, peg_blocked=False, entered=True)
    log("[ENTRY GATE] ENTRY ALLOWED")
    return open_trade(signal)
ğŸ“ Ø±Ø¨Ø· PEG Ø¨Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·)
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
# Ø¯Ø§Ø®Ù„ exit_trade()
PostExitGuard.get().record_exit(
    exit_price=trade.exit_price,
    timestamp=now()
)
âŒ Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¨Ø¨ Ø§Ù„Ø®Ø±ÙˆØ¬
âŒ Ù„Ø§ Ù…Ù†Ø¹ Stop Loss
âŒ Ù„Ø§ ØªØºÙŠÙŠØ± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±
ğŸ“Š EntryGateMonitor (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
Python
class EntryGateMonitor:
    _instance = None

    @classmethod
    def get(cls):
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance

    def __init__(self):
        self.stats = {
            "clean_entries": 0,
            "lpem_only_blocks": 0,
            "peg_only_blocks": 0
        }

    def record_decision(self, lpem_blocked, peg_blocked, entered):
        if entered:
            self.stats["clean_entries"] += 1
        elif lpem_blocked:
            self.stats["lpem_only_blocks"] += 1
        elif peg_blocked:
            self.stats["peg_only_blocks"] += 1
ğŸ§ª Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬
âŒ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… (ÙŠØ®ØªÙÙŠ):
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©

Exit
â†’ Enter ÙÙˆØ±Ù‹Ø§
â†’ Exit Ø®Ø³Ø§Ø±Ø©
âœ… Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
Ù†Ø³Ø® Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©

Exit
â†’ LPEM ÙŠÙ…Ù†Ø¹ (Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©)
â†’ Ø£Ùˆ PEG ÙŠÙ…Ù†Ø¹ (Ø³ÙˆÙ‚ Ù„Ù… ÙŠØªØ¹Ø§ÙÙ)
â†’ Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø­Ø¯ Ù†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØ±ØµØ© ØµØ­ÙŠØ­Ø©
ğŸ›¡ï¸ Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©
âœ… Ù„Ø§ Ù…Ù†Ø¹ Ø¯Ø§Ø¦Ù… (PEG Ù„Ù‡ Ø­Ø¯ Ø²Ù…Ù†ÙŠ)
âœ… Ù„Ø§ ØªØ£Ø®ÙŠØ± Ø²Ù…Ù†ÙŠ Ø«Ø§Ø¨Øª
âœ… Ù„Ø§ ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯ÙˆØ§Ù†ÙŠØ©
âœ… Ù„Ø§ ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ
âœ… Ù‚Ø±Ø§Ø± ÙˆØ§Ø­Ø¯ â€“ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø© â€“ Ø³Ù„ÙˆÙƒ ÙˆØ§Ø¶Ø­