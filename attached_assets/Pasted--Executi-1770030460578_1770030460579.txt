Ø§ÙØ­Øµ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹ ÙˆÙ†ÙÙ‘Ø° Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø© ØµØ§Ø±Ù…Ø© Ù„Ù…Ù†Ø¹ Ø£ÙŠ Ø§Ù†ÙØµØ§Ù„ Ø¨ÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ù€ ExecutionEngine.
ðŸš¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙˆÙ„ÙŠØ³ Ø§Ù‚ØªØ±Ø§Ø­:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ðŸŽ¯ Ø§Ù„Ù‡Ø¯Ù â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ExecutionEngine Ù‡Ùˆ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù„Ù„ØµÙÙ‚Ø§Øª. Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø£ÙŠ state Ù…Ø­Ù„ÙŠ Ù„Ù„ØµÙÙ‚Ø§Øª Ø®Ø§Ø±Ø¬ engine.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âŒ Ø§Ø­Ø°Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (main.py + trade_modes.py + Ø£ÙŠ Ù…Ù„Ù):
Ø§Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹:
state.position_open
state.entry_price
quick_scalp_down_state
finalize_trade
execute_paper_buy
manage_trade_exits
Ø£ÙŠ Ù…ØªØºÙŠØ± ÙŠØ®Ø²Ù† Ø­Ø§Ù„Ø© ØµÙÙ‚Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
Ø£ÙŠ reset_position_state Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„ØµÙÙ‚Ø©
Ù„Ø§ Ø£Ø±ÙŠØ¯ Ø£ÙŠ Local Trade State Ø¥Ø·Ù„Ø§Ù‚Ø§Ù‹.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âœ… Ø§Ù„Ø¯Ø®ÙˆÙ„ (OPEN) â€” Ø¥Ø¬Ø¨Ø§Ø±ÙŠ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø£ÙŠ ÙØªØ­ ØµÙÙ‚Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… ÙÙ‚Ø· Ø¹Ø¨Ø±:
await execution_engine.request_trade({ "type": "OPEN", "symbol": SYMBOL, "amount": amount })
Ù…Ù…Ù†ÙˆØ¹ ØªÙ…Ø§Ù…Ø§Ù‹:
state.position_open = True
Ø£ÙŠ ØªÙ†ÙÙŠØ° ÙŠØ¯ÙˆÙŠ
Ø£ÙŠ broker Ù…Ø¨Ø§Ø´Ø±
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âœ… Ø§Ù„Ø®Ø±ÙˆØ¬ (CLOSE) â€” Ø¥Ø¬Ø¨Ø§Ø±ÙŠ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙ‚Ø· Ø¹Ø¨Ø±:
await execution_engine.close_trade_atomically(reason, price)
ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ø³Ø§Ø± Ø¢Ø®Ø±.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âœ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (READ STATE) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† state.position_open Ø§Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·:
pos = execution_engine.get_position_state()
if pos["position_open"]: entry = pos["entry_price"]
ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ù…ØªØºÙŠØ± Ø¢Ø®Ø±.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ðŸŽ¯ FAST_SCALP_DOWN (Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø§Ø³ØªØ¨Ø¯Ù„ quick_scalp_down_manage_trade Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙ‚Ø·:
async def quick_scalp_down_manage_trade(bot, chat_id, current_price, _): pos = execution_engine.get_position_state()
if not pos["position_open"]:
    return False

entry = pos["entry_price"]

pnl = (current_price - entry) / entry * 100

print(f"[FAST_DOWN] pnl={pnl:.4f}%")

if pnl >= 0.10:
    await execution_engine.close_trade_atomically("FAST_TP", current_price)
    return True

if pnl <= -0.12:
    await execution_engine.close_trade_atomically("FAST_SL", current_price)
    return True

return False
Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø´Ø±ÙˆØ· Ø¥Ø¶Ø§ÙÙŠØ©. Ø¨Ø¯ÙˆÙ† state. Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ±. Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù…Ù†Ø·Ù‚ Ø¢Ø®Ø±.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø© â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø£ÙŠ ØµÙÙ‚Ø© Ù„Ø§ ØªÙ…Ø± Ø¹Ø¨Ø± engine ØªØ¹ØªØ¨Ø± BUG
Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… finalize_trade Ø¥Ø·Ù„Ø§Ù‚Ø§Ù‹
Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ù…ØªØºÙŠØ± position_open Ù…Ø­Ù„ÙŠ
engine Ù‡Ùˆ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„Ù„Ø­Ù‚ÙŠÙ‚Ø©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø§Ø·Ø¨Ø¹ Ù„ÙŠ:
Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§
Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªÙŠ ØªÙ… Ø­Ø°ÙÙ‡Ø§
Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”